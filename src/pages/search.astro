---
import BaseLayout from "../layouts/BaseLayout.astro";
const modules = import.meta.glob("./calculators/*.mdx", { eager: true });
const items = Object.values(modules).map((m) => ({
  url: m.url,
  title: m.frontmatter?.title || m.url.replace('/calculators/','').replace('.mdx',''),
  description: m.frontmatter?.intro || m.frontmatter?.description || ''
}));
---
<BaseLayout title="Search" description="Find calculators by name or description.">
  <section class="hero container mx-auto max-w-5xl px-4">
    <h1 style="color: var(--ink)">Search</h1>
    <p style="color: var(--muted)">Find calculators by name or description.</p>
    <input
      id="search"
      type="search"
      placeholder="Search calculators..."
      class="mt-4 w-full max-w-xl rounded-md border border-[var(--border)] p-2"
      aria-label="Search calculators"
    />
  </section>
  <section class="section container mx-auto max-w-5xl px-4" aria-labelledby="search-results">
    <h2 id="search-results" class="sr-only">Search results</h2>
    <div id="results" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
  </section>
  <script is:inline>
    const items = {JSON.stringify(items)};
    const results = document.getElementById('results');
    function render(list) {
      results.innerHTML = list.map((it) => `
        <div>
          <a class="card" href="${it.url}">
            <h3>${it.title}</h3>
            <p>${it.description}</p>
          </a>
        </div>
      `).join('');
    }
    render(items);
    document.getElementById('search')?.addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      const filtered = items.filter((it) =>
        it.title.toLowerCase().includes(q) ||
        it.description.toLowerCase().includes(q)
      );
      render(filtered);
    });
  </script>
</BaseLayout>
