---
import BaseLayout from "../layouts/BaseLayout.astro";
import AdBanner from "../components/AdBanner.astro";
const modules = import.meta.glob("../pages/calculators/*.mdx", { eager: true });
const items = Object.values(modules).map((m) => ({
  url: m.url,
  title: m.frontmatter.title || m.url.replace('/calculators/','').replace('.mdx',''),
  description: m.frontmatter.intro || m.frontmatter.description || ''
}));
---
<BaseLayout title="Search" description="Search calculators by title or description.">
  <section class="hero container mx-auto max-w-5xl px-4">
    <h1 style="color: var(--ink)">Search</h1>
    <p style="color: var(--muted)">Find calculators by title or description.</p>
    <input
      id="search"
      type="search"
      placeholder="Search calculators..."
      class="mt-4 w-full rounded-md border border-[var(--border)] p-2"
      aria-label="Search calculators"
    />
  </section>
  <AdBanner />
  <section class="section container mx-auto max-w-5xl px-4">
    <h2 class="sr-only">Search results</h2>
    <div id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </section>
  <script is:inline>
    const items = {JSON.stringify(items).replace(/</g, '\u003c')};
    const input = document.getElementById('search');
    const results = document.getElementById('results');

    function render(list) {
      results.innerHTML = list
        .map(
          (it) => `
        <div>
          <a class="card" href="${it.url}">
            <h3>${it.title}</h3>
            <p>${it.description}</p>
          </a>
        </div>
      `
        )
        .join('');
    }

    render(items);

    input.addEventListener('input', () => {
      const q = input.value.toLowerCase();
      const filtered = items.filter(
        (it) =>
          it.title.toLowerCase().includes(q) ||
          it.description.toLowerCase().includes(q)
      );
      render(filtered);
    });
  </script>
</BaseLayout>
