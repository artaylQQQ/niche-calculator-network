---
import BaseLayout from "../layouts/BaseLayout.astro";
import AIAssistant from "../components/AIAssistant.astro";
const modules = import.meta.glob("./calculators/*.mdx", { eager: true });
const items = Object.values(modules).map((m) => ({
  url: m.url,
  title: m.frontmatter?.title || m.url.replace('/calculators/','').replace('.mdx',''),
  description: m.frontmatter?.intro || m.frontmatter?.description || ''
}));
---
<BaseLayout title="Search" description="Search calculators by title or description.">
  <section class="hero container mx-auto max-w-5xl px-4">
    <h1 style="color: var(--ink)">Search</h1>
    <p style="color: var(--muted)">Find a calculator by title or description.</p>
    <input
      id="search-input"
      type="search"
      placeholder="Search calculators"
      class="w-full mt-4 p-2 border rounded-md"
    />
  </section>
  <section class="section container mx-auto max-w-5xl px-4" aria-labelledby="search-results">
    <h2 id="search-results" class="sr-only">Search results</h2>
    <div id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
      {items.map((it) => (
        <div data-title={it.title.toLowerCase()} data-description={it.description.toLowerCase()}>
          <a class="card" href={it.url}>
            <h3>{it.title}</h3>
            <p>{it.description}</p>
          </a>
        </div>
      ))}
    </div>
  </section>
  <div class="container mx-auto max-w-5xl px-4 mt-8">
    <AIAssistant />
  </div>
  <script is:inline>
    const input = document.getElementById('search-input');
    const cards = Array.from(document.querySelectorAll('#results > div'));
    function filter() {
      const q = input.value.trim().toLowerCase();
      cards.forEach((card) => {
        const t = card.dataset.title;
        const d = card.dataset.description;
        const match = !q || t.includes(q) || d.includes(q);
        card.style.display = match ? '' : 'none';
      });
    }
    input.addEventListener('input', filter);
  </script>
</BaseLayout>
