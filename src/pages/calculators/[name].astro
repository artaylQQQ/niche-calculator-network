---
import fs from 'node:fs';
import path from 'node:path';

// This dynamic route handles short calculator slugs without the
// `-calculator` suffix.  For example, a request to
// `/calculators/percentage-discount/` will redirect to
// `/calculators/percentage-discount-calculator/` if that page exists.

const { name } = Astro.params;
// Compose the long slug by appending "-calculator" to the incoming name
const longSlug = `${name}-calculator`;

// Resolve the absolute path to the corresponding MDX file
const calcPath = path.resolve(process.cwd(), 'src/pages/calculators', `${longSlug}.mdx`);

// Check if the MDX file exists on disk
const exists = fs.existsSync(calcPath);
---
{exists ? (
  <head>
    {/* Use a meta refresh to immediately redirect to the canonical slug. */}
    <meta http-equiv="refresh" content={`0; URL=/calculators/${longSlug}/`} />
  </head>
) : (
  // If no matching file is found, fall back to the default 404 page.
  // The framework will render the built-in 404 when this component returns undefined.
  undefined
)}