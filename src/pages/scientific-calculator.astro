---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Scientific Calculator" description="Perform advanced math operations with this scientific calculator.">
  <div class="max-w-sm mx-auto mt-8">
    <div id="calc" class="bg-white p-4 rounded-lg shadow-lg">
      <input
        id="display"
        class="w-full mb-2 p-3 border rounded text-right text-2xl bg-gray-100 text-slate-900"
        readonly
      />
      <div class="grid grid-cols-5 gap-2">
        <button data-value="(" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">(</button>
        <button data-value=")" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">)</button>
        <button data-value="sin(" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">sin</button>
        <button data-value="cos(" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">cos</button>
        <button data-value="tan(" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">tan</button>
        <button data-value="7" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">7</button>
        <button data-value="8" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">8</button>
        <button data-value="9" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">9</button>
        <button data-value="/" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">÷</button>
        <button data-value="sqrt(" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">√</button>
        <button data-value="4" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">4</button>
        <button data-value="5" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">5</button>
        <button data-value="6" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">6</button>
        <button data-value="*" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">×</button>
        <button data-value="^" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">^</button>
        <button data-value="1" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">1</button>
        <button data-value="2" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">2</button>
        <button data-value="3" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">3</button>
        <button data-value="-" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">−</button>
        <button data-value="log(" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">log</button>
        <button data-value="0" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">0</button>
        <button data-value="." class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">.</button>
        <button data-value="=" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">=</button>
        <button data-value="+" class="p-2 rounded border bg-gray-100 text-slate-900 hover:bg-gray-200 active:bg-gray-300 transition-colors font-semibold">+</button>
        <button data-value="C" class="p-2 rounded border bg-red-500 hover:bg-red-600 text-white font-semibold">C</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script>
    const display = document.getElementById('display');
    const buttons = document.querySelectorAll('#calc button');
    let current = '';

    function evaluateExpression(expr) {
      try {
        const safeExpr = expr
          .replace(/\^/g, '**')
          .replace(/sin\(([^)]+)\)/g, (_, a) => `tf.sin(${a}).arraySync()[0]`)
          .replace(/cos\(([^)]+)\)/g, (_, a) => `tf.cos(${a}).arraySync()[0]`)
          .replace(/tan\(([^)]+)\)/g, (_, a) => `tf.tan(${a}).arraySync()[0]`)
          .replace(/sqrt\(([^)]+)\)/g, (_, a) => `tf.sqrt(${a}).arraySync()[0]`)
          .replace(/log\(([^)]+)\)/g, (_, a) => `tf.log(${a}).arraySync()[0]`);
        return eval(safeExpr);
      } catch {
        return 'Error';
      }
    }

    function handleInput(val) {
      if (val === 'C') {
        current = '';
      } else if (val === '=') {
        current = evaluateExpression(current).toString();
      } else {
        current += val;
      }
      display.value = current;
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', () => handleInput(btn.dataset.value));
    });

    document.addEventListener('keydown', e => {
      const key = e.key;
      if (/[0-9]/.test(key) || ['+', '-', '*', '/', '.', '(', ')', '^'].includes(key)) {
        handleInput(key);
      } else if (key === 'Enter') {
        handleInput('=');
      } else if (key === 'Escape') {
        handleInput('C');
      } else if (key === 'Backspace') {
        current = current.slice(0, -1);
        display.value = current;
      }
    });
  </script>
</BaseLayout>

