---
import BaseLayout from '../layouts/BaseLayout.astro';

/*
  Sitemap page

  This page generates a simple index of all categories and calculators on
  the site.  Categories are listed with a brief description and link to
  their respective pages, followed by a complete list of calculators.
  Each calculator entry shows its title and intro.  The data is read
  eagerly at build time via Astro’s glob import.  See also
  `src/pages/all.astro` for a similar implementation.
*/

// Import all calculator MDX modules.  The `glob` helper returns an
// object keyed by file path, each containing the page’s URL and
// frontmatter.  We map these values into a more convenient array.
const modules = import.meta.glob('../pages/calculators/*.mdx', { eager: true });
const items = Object.values(modules).map((m) => ({
  url: m.url,
  title: m.frontmatter?.title ?? m.url.split('/').pop().replace('.mdx',''),
  intro: m.frontmatter?.intro || m.frontmatter?.description || '',
  cluster: (m.frontmatter?.cluster || '').toLowerCase()
}));

// Define the canonical list of categories.  These match the slugs and
// descriptions used on the home and categories pages.  Should you
// rename or remove a category, update this list accordingly.
const categories = [
  { slug: 'finance',     title: 'Finance',     desc: 'Loans, interest, ROI, taxes' },
  { slug: 'health',      title: 'Health',      desc: 'BMI and body metrics' },
  { slug: 'conversions', title: 'Conversions', desc: 'Unit and currency conversions' },
  { slug: 'math',        title: 'Math',        desc: 'Geometry, algebra and statistics' },
  { slug: 'technology',  title: 'Technology',  desc: 'Computing and tech topics' },
  { slug: 'date-time',   title: 'Date & Time', desc: 'Schedules and durations' },
  { slug: 'home-diy',    title: 'Home & DIY',  desc: 'Household projects and DIY' },
  { slug: 'other',       title: 'Other',       desc: 'Everyday & misc calculators' }
];
---
<BaseLayout title="Sitemap" description="Index of all calculator categories and pages.">
  <section class="hero container mx-auto max-w-5xl px-4 pt-10">
    <h1 style="color: var(--ink)">Sitemap</h1>
    <p style="color: var(--muted)">Browse categories and calculators across our site.</p>
  </section>

  <section class="section container mx-auto max-w-5xl px-4">
    <h2 style="color: var(--ink);margin-bottom:16px;">Categories</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {categories.map((cat) => (
        <div>
          <a href={`/categories/${cat.slug}/`} class="card">
            <h3>{cat.title}</h3>
            <p>{cat.desc}</p>
          </a>
        </div>
      ))}
    </div>
  </section>

  <section class="section container mx-auto max-w-5xl px-4">
    <h2 style="color: var(--ink);margin-bottom:16px;">All Calculators</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {items.map((it) => (
        <div>
          <a href={it.url} class="card">
            <h3>{it.title}</h3>
            <p>{it.intro}</p>
          </a>
        </div>
      ))}
    </div>
  </section>
</BaseLayout>