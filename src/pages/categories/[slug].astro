---
import BaseLayout from '../../layouts/BaseLayout.astro';
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

export async function getStaticPaths() {
  const CATEGORIES = [
    { slug: 'finance',     name: 'Finance Calculators', aliases: ['finance','finance & loans','taxes','business','business & commerce','percentages & ratios'] },
    { slug: 'health',      name: 'Health Calculators', aliases: ['health','health & fitness','bmi'] },
    { slug: 'conversions', name: 'Conversions Calculators', aliases: ['conversions','unit conversions','unit and currency conversions'] },
    { slug: 'math',        name: 'Math Calculators', aliases: ['math','geometry','geometry & math','areas & volumes','algebra','statistics','averages and probabilities','percentages & ratios'] },
    { slug: 'technology',  name: 'Technology Calculators', aliases: ['technology','tech','computing','technology & computing'] },
    { slug: 'date-time',   name: 'Date & Time Calculators', aliases: ['date & time','time & date','time-date','durations and schedules'] },
    { slug: 'home-diy',    name: 'Home & DIY Calculators', aliases: ['home & diy','home and diy','diy','household'] },
    { slug: 'other',       name: 'Other Calculators', aliases: ['other','misc','miscellaneous','everyday','everyday & misc','general'] }
  ];
  const __filename = fileURLToPath(import.meta.url);
  const __dirname  = path.dirname(__filename);
  const dataPath   = path.resolve(__dirname, '../../../data/calculators.json');
  let calcs = [];
  try { calcs = JSON.parse(fs.readFileSync(dataPath, 'utf-8')); } catch {}
  return CATEGORIES.map(cat => {
    const list = calcs.filter(c => cat.aliases.includes((c.cluster||'').toLowerCase()));
    return { params: { slug: cat.slug }, props: { title: cat.name, calculators: list } };
  });
}

const { title, calculators = [] } = Astro.props;
---
<BaseLayout title={title} description={`Explore ${title.toLowerCase()} in our collection`} canonical={Astro.url}>
  <section class="hero container mx-auto max-w-5xl px-4">
    <h1 style="color: var(--ink); margin-bottom: 8px;">{title}</h1>
    <p style="color: var(--muted); margin-bottom: 16px;">Explore calculators in this category.</p>
  </section>
  {calculators.length > 0 ? (
    <ul class="calc-list">
      {calculators.map(calc => (
        <li><a href={`/calculators/${calc.slug}/`} title={calc.title}>{calc.title} â€“ <small>{calc.description}</small></a></li>
      ))}
    </ul>
  ) : (
    <p style="padding: 16px; font-style: italic;">No calculators available in this category yet. Please check another category.</p>
  )}
</BaseLayout>

<style>
  .calc-list { list-style: none; padding-left: 16px; margin-bottom: 24px; }
  .calc-list li { margin: 8px 0; }
  .calc-list a { text-decoration: none; color: var(--link, #1565c0); }
  .calc-list small { color: var(--muted); }
</style>
